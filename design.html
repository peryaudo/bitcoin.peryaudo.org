<!-- DO NOT EDIT THIS FILE, this file is generated by src/conv.rb -->

<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Bitcoinの仕組み - ビットコインの仕組み：Bitcoinを技術的に徹底解説！</title>
		<meta name="description" content="だれにでも分かるように、ビットコインの仕組みの基本を解説。">
		<link rel="stylesheet" href="res/style.css">
		<link rel="alternate" type="application/rss+xml" href="http://bitcoin.peryaudo.org/index.rdf" />
        <meta name=viewport content="width=device-width, initial-scale=1">
		<script type="text/javascript">
			window.google_analytics_uacct = "UA-530611-8";
		</script>
	</head>
	<body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-530611-8', 'peryaudo.org');
  ga('send', 'pageview');

</script>
		<div id="container">
			<div id="header">
				<h1>ビットコインの仕組み</h1>
				<a href="index.html"><img id="logo" src="res/logo.png" alt="ビットコインの仕組み"></a>
				<a href="https://github.com/peryaudo/bcwallet"><img style="position: absolute; top: 0; right: 0; border: 0;" src="res/fork_me_on_github.png" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
			</div>
			<div id="content">
				<h2 id="bitcoinの仕組み">Bitcoinの仕組み</h2>

<p>Bitcoinは、銀行のような中央を経由せず、直接、1対1で通貨のようなものを取引できる仕組みである。これはつまり、サーバー・クライアントモデルに基づいた信用によらず、取引ができるということである。</p>

<p>この仕組みは、P2P（Peer-to-peer）技術と、公開鍵暗号などの暗号技術を用いて実現されている。このような「通貨」は、Bitcoinによってはじめて実現されたが、現在、同様の仕組みを用いた通貨は、Bitcoinの他にも多数存在する。（<a href="history.html">Bitcoinの歴史</a>、<a href="derivatives.html">Bitcoinの派生通貨</a>）これらをまとめて、「暗号通貨」（Cryptocurrency; クリプト・カレンシー）と呼ぶ。</p>

<div class="tip"><p><a href="http://e-words.jp/w/E38395E382A1E382A4E383ABE585B1E69C89E382BDE38395E38388.html">ファイル共有</a>や<a href="http://e-words.jp/w/VoIP.html">VoIP</a>などで用いられるP2P技術には、様々な凝ったアルゴリズムが存在している。しかし、Bitcoinはそういったアルゴリズムとは無縁の、非常に単純な構造のP2Pのネットワークを形成している。この単純さはBitcoinの堅牢性にも繋がっている。「暗号通貨」という名前に反して通信も暗号化されていない。</p></div>

<div class="toc"><ul>
<li>
<a href="#bitcoinの仕組み">Bitcoinの仕組み</a>
<ul>
<li>
<a href="#取引履歴で通貨を表現">取引履歴で通貨を表現</a>
</li>
<li>
<a href="#ブロックチェーンで二重譲渡を防ぐ">ブロックチェーンで二重譲渡を防ぐ</a>
</li>
<li>
<a href="#仕事の証明によるブロックの生成">仕事の証明によるブロックの生成</a>
</li>
<li>
<a href="#マイニングによる利益">マイニングによる利益</a>
</li>
<li>
<a href="#正しいブロックチェーンの決定">正しいブロックチェーンの決定</a>
</li>
<li>
<a href="#まとめ">まとめ</a>
</li>
</ul>
</li>
</ul>
</div>

<h3 id="取引履歴で通貨を表現">取引履歴で通貨を表現</h3>

<p>P2Pで、いかにして通貨を表現するかを考えよう。</p>

<p>Bitcoinでは通貨を、コインの経てきた、すべての取引履歴のかたまりとして表現する。具体的には、「トランザクション」(Transaction; 取引)を以下のように定義する。各トランザクションは、前のトランザクションのハッシュ値や、新たな所有者の公開鍵を含み、元のコインの所有者の暗号鍵によって電子署名されている。全てのトランザクションの情報は、P2Pネットワーク全体で共有される。</p>

<div class="figure"><img src="res/fig_transactions.png" alt="図: トランザクションの定義"><p class="caption">図: トランザクションの定義</p></div>

<p>一見分かりづらいかもしれないが、取引をこのように表現することで、すでに通貨としての多くの特性を表現できていることが分かる。例えば、あるコインについて、元の所有者の許可なく、コインを本人以外が勝手に譲渡することはできない。また、第三者は、ある人からある人へのコインの譲渡を、客観的に確認することができる。</p>

<p>しかし、この仕組みだけでは、これを通貨として用いることはできない。なぜならば、二重譲渡を防ぐ仕組みがないからである。二重譲渡とは、元のコインの持ち主が二人以上の相手に、全く同じコインを譲渡することである。通貨として用いるためには、どちらの譲渡のみを、ネットワーク全体で、正しい取引として決定する必要がある。一般的には、時系列的に後のトランザクションを無効とみなすのが自然だ。しかし、これらの取引はP2Pネットワーク上でなされるので、ネットワーク全体として見たとき、どちらが先に行われた取引かということを、確実には決定できない。</p>

<!--ADS-->

<h3 id="ブロックチェーンで二重譲渡を防ぐ">ブロックチェーンで二重譲渡を防ぐ</h3>

<p>重要なのは、ネットワーク全体で、特定のどちらか一方のみを一貫して、正しい取引であると決定できることである。前の節で説明したとおりに通貨を表現することにより、不正を働くことができるのは、コインを持っている人だけとなっている。したがって、矛盾する二つの取引のあるとき、厳密にどちらの取引が先になされたかというのは、あまり重要でない。</p>

<p>そこでBitcoinで導入されたのが、「ブロックチェーン」（Block Chain; ブロック鎖）という仕組みである。それぞれの「ブロック」（Block）は、多数のトランザクションと、あとで説明する「ナンス」（Nonce）と呼ばれる特別な値、そして直前のブロックのハッシュを持っている。「ブロック」に含まれた取引のみを「正しい取引」と認めることにする。そして、ネットワーク全体で「唯一のブロックの鎖」を持つようにする。これによって、一貫した取引履歴を全体が共有できる、というのがブロックチェーンのコンセプトである。</p>

<div class="figure"><img src="res/fig_blockchain.png" alt="図: ブロックの定義"><p class="caption">図: ブロックの定義</p></div>

<p>しかし、ここで当然のように、誰が「ブロック」を作成するのかという問題が生じる。特定の誰かのみにブロックを生成する権限を与えたら、「特権的立場を持った存在のいない誰もが平等な通貨」という性質が失われてしまう。かといって、誰でも無条件でブロックを生成することができたら、どれが「唯一の正しいブロックの鎖」なのか、誰にも分からなくなってしまう。</p>

<h3 id="仕事の証明によるブロックの生成">仕事の証明によるブロックの生成</h3>

<p>ここで用いられるのが「仕事の証明」（proof-of-work, PoW; プルーフ・オブ・ワーク）と呼ばれる仕組みである。
それぞれのブロックについて、SHA-256ハッシュを取ることを考える。このハッシュの先頭に、一定の数以上の0が並んでいるブロックのみを、「正しいブロック」として、ネットワーク全体で認めることにする。ブロックには、ナンスと呼ばれる特別な値が含まれていたことを思い出してほしい。ナンスを変えることで、ブロック全体のSHA-256ハッシュを変化させることができるので、条件を満たすようなハッシュを持ったブロックを作ることができる。</p>

<div class="figure"><img src="res/fig_hashes.png" alt="図: 頭に0の並んだ、実際のブロックのハッシュ"><p class="caption">図: 頭に0の並んだ、実際のブロックのハッシュ（<a href="https://blockchain.info/ja/block-index/473307/0000000000000000358fa848b19facc99fa1d6d56775eeee5025d8f34f77b31f">Blockchain.info</a>）</p></div>

<p>SHA-256などのような暗号学的ハッシュ関数は、ハッシュ値から、簡単にデータを逆算できないように設計されている。（<a href="background.html">必要な予備知識</a>）したがって、全探索・総当り以外の方法で、条件を満たすようなナンスを探すことはできない。これは、計算資源を使わないと、条件を満たすブロックを生成することができないということである。これによって、ブロックの作成に「誰でも作成できる訳ではないが、特定の誰かのみが作成する権限を持っている訳でもない」という性質を持たせることができた。P2Pネットワーク上の各ノードは、ナンス値を変化させながら、全探索・総当りをし、条件を満たすブロックを発見しようと努力する。そして、これをみつけたノードは、そのブロックを他ノードに配信し、ネットワーク上の全てのノードがこれを認めるのである。</p>

<p>ブロック生成の難易度は、過去のブロック生成速度に応じて、およそ10分に1個のブロックが発掘されるよう、適切な値が設定されるようになっている。（<a href="detail.html">Bitcoinの細部</a>）
コンピュータの性能は爆発的に向上してきていることが知られている。これは、もし探索の難易度（つまり、ハッシュの先頭にいくつ0が必要か）が一定のままだとすると、やがてブロックはただ同然の計算資源で生成できるようになってしまうということを意味する。また、ネットワークに参加するノードが増えるにつれてブロックの生成速度が次第に速くなっていってしまうということも意味し、これも同様に望ましくない。したがって、難易度を変化させる必要がある。</p>

<p>実際のブロックチェーンのデータは、<a href="https://blockchain.info/">Blockchain.info</a>などで閲覧することができる。</p>

<h3 id="マイニングによる利益">マイニングによる利益</h3>

<p>前の節で、ブロックの生成には計算資源を使う必要があることを説明した。しかし、ブロックの生成に見返りがなければ、わざわざコストをかけてコンピュータや機材を買って、ブロックを生成してくれる人はいないだろう。したがって、ブロックの生成には報酬がある。</p>

<p>報酬は、それぞれのブロックの先頭にある、コインベース（coinbase）と呼ばれる、特殊なトランザクションによって実現されている。このトランザクションは、誰かから誰かへのコインの譲渡を表すのではなく、コインの生成を表すトランザクションである。受取先はブロックの生成者である。この特殊なトランザクションのおかげで、ブロックを生成すると生成者は、一定額の定められたコインを報酬としてもらうことができる。</p>

<p>Bitcoinを金などの鉱物になぞらえたとき、ブロックの生成は採掘作業ともみなせる。よって、ブロックを生成することは一般に「マイニング」と呼ばれている。</p>

<h3 id="正しいブロックチェーンの決定">正しいブロックチェーンの決定</h3>

<p>以上の仕組みによって、中央を持たずとも、Bitcoinネットワークは正しいブロックチェーンを作り上げていくことができる。しかし、ここまでの仕組みだけでは、ブロックチェーンが絶対に分岐しないことを保証するには不十分である。そのためBitcoinは、分岐点から先がより長いほうのブロックチェーンを、常に正しいブロックチェーンとして認める、という規則を導入している。</p>

<div class="figure"><img src="res/fig_deadchain.png" alt="図: ブロックチェーン"><p class="caption">図: ブロックチェーン</p></div>

<p>これは単純な方法であり、一見してまだ不十分であるようにも見える。しかし、Bitcoinの原著論文では、これについて、確率論的な説明がなされている。（<a href="vendor/bitcoin.pdf">論文(PDF)</a>の11章）論文によると、攻撃者とブロックチェーンの伸ばし合い競争をした場合、善意のノードの持つ計算資源が、攻撃者のそれより少しでも多いかぎり、攻撃者がブロックチェーンを乗っ取れる可能性はきわめて低いとされている。</p>

<h3 id="まとめ">まとめ</h3>

<p>Bitcoinは、</p>

<ul>
<li>電子署名を使い、コインを取引のかたまりとして表現し、</li>
<li>二重譲渡をブロックチェーンと仕事の証明により防ぎ、</li>
<li>ブロックの生成者には報酬が与えられる。（マイニング）</li>
</ul>

<p>以上がおおまかなBitcoinの原理の説明である。登場した概念の中で、本当の意味で、多くの人々にとってなじみのないものは、仕事の証明ぐらいだろうと思う。Bitcoinの原理自体は決して難解でないという事がご理解いただけただろうか。</p>

<p>「<a href="comparison.html">Bitcoinウォレットの比較</a>」につづく</p>

			</div>
			<div id="menu">
				<ul>
					<li><a href="index.html">トップ</a></li>
<li><a href="design.html">Bitcoinの仕組み</a></li>
<li><a href="comparison.html">Bitcoinウォレットの比較</a></li>
<li><a href="detail.html">Bitcoinの細部</a></li>
<li><a href="implement.html">Bitcoinウォレットを実装する</a></li>
<li><a href="malleability.html">トランザクション展性とは</a></li>
<li><a href="derivatives.html">Bitcoinの派生通貨</a></li>
<li><a href="history.html">Bitcoinの歴史</a></li>
<li><a href="links.html">リンク集</a></li>
</ul><ul>
<li><a href="intro.html">はじめに</a></li>
<li><a href="sitemap.html">サイトの構成</a></li>
<li><a href="background.html">必要な予備知識</a></li>
				</ul>
				<ul>
					<li><a href="http://peryaudo.org/">筆者紹介</a></li>
					<li><a href="http://bitcoin.peryaudo.org/index.rdf">RSS 2.0</a></li>
				</ul>
				<ul>
					<li><a href="https://github.com/peryaudo/bitcoin.peryaudo.org">このページの編集を提案</a></li>
				</ul>
			</div>
			<div id="footer">
				<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><a xmlns:cc="http://creativecommons.org/ns#" href="http://bitcoin.peryaudo.org/" property="cc:attributionName" rel="cc:attributionURL">peryaudo</a> 作『<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">ビットコインの仕組み</span>』は<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">クリエイティブ・コモンズ 表示 - 継承 4.0 国際 ライセンス</a>で提供されています。
			</div>
		</div>
	</body>
</html>
